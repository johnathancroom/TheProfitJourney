<% content_for :body_content_title do %>
  <%= "#{page_title}: Daily Managers Report" %>
<% end %>

<% content_for :body do %>
  <%= link_to 'New DMR Entry', refinery.new_akouo_journeyboard_dmr_path %> |
  <%= link_to 'Edit Budgets', refinery.budget_akouo_journeyboard_dmr_index_path %> |
  <%= link_to 'Comfort Advisors', refinery.akouo_journeyboard_comfort_advisors_path %> |
  <%= link_to 'Entries', refinery.akouo_journeyboard_entries_path %>

  <%= link_to "Edit #{@date.strftime('%B %e, %Y')}", refinery.edit_akouo_journeyboard_dmr_path(@entry), :class => 'button dmr_edit' if !@entry.blank? %>

  <hr>

  <%= render 'data_select' %>

  <hr>

  <h1>Daily Performance</h1>
  <table class="journeyboard">
    <% if @entry.blank? %>
      <tr>
        <td>No Data for <%= @date.strftime('%B %e, %Y') %></td>
      </tr>
    <% else %>
      <% th = '
          <th>Daily Actual</th>
          <th>Daily Budget</th>
          <th>MTD Actual</th>
          <th>MTD Budget</th>
          <th>Total Budget</th>
      ' %>
      <thead>
        <tr>
          <th><strong>Replacement</strong></th>
          <%=raw th %>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Replacement Dollars Sold</td>
          <td><%= number_to_currency @entry.comfort_advisor_entries.sum(:sold) %></td>
          <td><%= number_to_currency(@budget.replacement_dollars_sold/@budget_days) %></td>
          <td>
            <%
              num = 0
              @entries.each do |x|
                num += x.comfort_advisor_entries.sum(:sold)
              end
            %>
            <%= number_to_currency num %>
          </td>
          <td><%= number_to_currency((@budget.replacement_dollars_sold/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.replacement_dollars_sold %></td>
        </tr>

        <tr>
          <td>Replacement Calls Run</td>
          <td><%= @entry.comfort_advisor_entries.sum(:calls_run) %></td>
          <td><%= @budget.replacement_calls_run/@budget_days %></td>
          <td>
            <%
              num = 0
              @entries.each do |x|
                num += x.comfort_advisor_entries.sum(:calls_run)
              end
            %>
            <%= num %>
          </td>
          <td><%= (@budget.replacement_calls_run/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.replacement_calls_run %></td>
        </tr>

        <tr>
          <td>Replacement Calls Sold</td>
          <td><%= @entry.comfort_advisor_entries.sum(:calls_sold) %></td>
          <td><%= @budget.replacement_calls_sold/@budget_days %></td>
          <td>
            <%
              num = 0
              @entries.each do |x|
                num += x.comfort_advisor_entries.sum(:calls_sold)
              end
            %>
            <%= num %>
          </td>
          <td><%= (@budget.replacement_calls_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.replacement_calls_sold %></td>
        </tr>

        <tr>
          <td>Closing Ratio</td>
          <td>
            <% if @entry.comfort_advisor_entries.sum(:calls_run) == 0 or @entry.comfort_advisor_entries.sum(:calls_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.comfort_advisor_entries.sum(:calls_sold).to_f/@entry.comfort_advisor_entries.sum(:calls_run).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @budget.replacement_calls_run == 0 or @budget.replacement_calls_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@budget.replacement_calls_sold.to_f/@budget.replacement_calls_run.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <%
              num1 = 0
              num2 = 0
              @entries.each do |x|
                num1 += x.comfort_advisor_entries.sum(:calls_run)
                num2 += x.comfort_advisor_entries.sum(:calls_sold)
              end
            %>
            <% if num1 == 0 or num2 == 0 %>
              &ndash;
            <% else %>
              <%= "#{((num2.to_f/num1.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.replacement_calls_run == 0 or @budget.replacement_calls_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.replacement_calls_sold.to_f/@budget.replacement_calls_run.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Average Ticket</td>
          <td>
            <% if @entry.comfort_advisor_entries.sum(:sold) == 0 or @entry.comfort_advisor_entries.sum(:calls_sold) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.comfort_advisor_entries.sum(:sold)/@entry.comfort_advisor_entries.sum(:calls_sold)) %>
            <% end %>
          </td>
          <td>
            <% if @budget.replacement_dollars_sold == 0 or @budget.replacement_calls_sold == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@budget.replacement_dollars_sold/@budget.replacement_calls_sold) %>
            <% end %>
          </td>
          <td>
            <%
              num1 = 0
              num2 = 0
              @entries.each do |x|
                num1 += x.comfort_advisor_entries.sum(:sold)
                num2 += x.comfort_advisor_entries.sum(:calls_sold)
              end
            %>
            <% if num1 == 0 or num2 == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(num1/num2) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.replacement_dollars_sold == 0 or @budget.replacement_calls_sold == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.replacement_dollars_sold/@budget.replacement_calls_sold) %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replaced Yesterday</td>
          <td><%= number_to_currency @entry.replacement_replaced %></td>
          <td><%= number_to_currency(@budget.replacement_replaced/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:replacement_replaced) %></td>
          <td><%= number_to_currency((@budget.replacement_replaced/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.replacement_replaced %></td>
        </tr>

        <tr>
          <td>Installed Yesterday</td>
          <td><%= number_to_currency @entry.replacement_installed %></td>
          <td><%= number_to_currency(@budget.replacement_installed/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:replacement_installed) %></td>
          <td><%= number_to_currency((@budget.replacement_installed/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.replacement_installed %></td>
        </tr>

        <tr>
          <td>COG's</td>
          <td><%= number_to_currency @entry.replacement_cogs %></td>
          <td><%= number_to_currency(@budget.replacement_cogs/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:replacement_cogs) %></td>
          <td><%= number_to_currency((@budget.replacement_cogs/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.replacement_cogs %></td>
        </tr>

        <tr>
          <td>Backlog</td>
          <td><%= number_to_currency @entry.replacement_backlog %></td>
          <td>&ndash;</td>
          <td>&ndash;</td>
          <td>&ndash;</td>
          <td>&ndash;</td>
        </tr>
      </tbody>

      <thead>
        <tr>
          <th><strong>Repair</strong></th>
          <%=raw th %>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Calls Run</td>
          <td><%= @entry.repair_calls %></td>
          <td><%= @budget.repair_calls/@budget_days %></td>
          <td><%= @entries.sum(:repair_calls) %></td>
          <td><%= (@budget.repair_calls/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_calls %></td>
        </tr>

        <tr>
          <td>Warranty Calls Run</td>
          <td><%= @entry.repair_warranty_calls %></td>
          <td><%= @budget.repair_warranty_calls/@budget_days %></td>
          <td><%= @entries.sum(:repair_warranty_calls) %></td>
          <td><%= (@budget.repair_warranty_calls/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_warranty_calls %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= number_to_currency @entry.repair_revenue %></td>
          <td><%= number_to_currency(@budget.repair_revenue/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:repair_revenue) %></td>
          <td><%= number_to_currency((@budget.repair_revenue/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.repair_revenue %></td>
        </tr>

        <tr>
          <td>COG's</td>
          <td><%= number_to_currency @entry.repair_cogs %></td>
          <td><%= number_to_currency(@budget.repair_cogs/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:repair_cogs) %></td>
          <td><%= number_to_currency((@budget.repair_cogs/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.repair_cogs %></td>
        </tr>

        <tr>
          <td>Average Ticket</td>
          <td>
            <% if @entry.repair_revenue == 0 or @entry.repair_calls == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.repair_revenue/@entry.repair_calls.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.repair_revenue/@budget_days) == 0 or (@budget.repair_calls/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.repair_revenue/@budget_days).to_f/(@budget.repair_calls/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:repair_revenue) == 0 or @entries.sum(:repair_calls) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:repair_revenue).to_f/@entries.sum(:repair_calls).to_f) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.repair_revenue == 0 or @budget.repair_calls == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.repair_revenue/@budget.repair_calls.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Membership Opportunities Run</td>
          <td><%= @entry.repair_membership_opportunities %></td>
          <td><%= @budget.repair_membership_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:repair_membership_opportunities) %></td>
          <td><%= (@budget.repair_membership_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_membership_opportunities %></td>
        </tr>

        <tr>
          <td>Memberships Sold</td>
          <td><%= @entry.repair_memberships_sold %></td>
          <td><%= @budget.repair_memberships_sold/@budget_days %></td>
          <td><%= @entries.sum(:repair_memberships_sold) %></td>
          <td><%= (@budget.repair_memberships_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_memberships_sold %></td>
        </tr>

        <tr>
          <td>Membership Conversion Rate</td>
          <td>
            <% if @entry.repair_membership_opportunities == 0 or @entry.repair_memberships_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.repair_memberships_sold.to_f/@entry.repair_membership_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.repair_membership_opportunities/@budget_days) == 0 or (@budget.repair_memberships_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.repair_memberships_sold/@budget_days).to_f/(@budget.repair_membership_opportunities/@budget_days).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:repair_membership_opportunities) == 0 or @entries.sum(:repair_memberships_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:repair_memberships_sold).to_f/@entries.sum(:repair_membership_opportunities))*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.repair_membership_opportunities == 0 or @budget.repair_memberships_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.repair_memberships_sold.to_f/@budget.repair_membership_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Opportunities Run</td>
          <td><%= @entry.repair_opportunities %></td>
          <td><%= @budget.repair_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:repair_opportunities) %></td>
          <td><%= (@budget.repair_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_opportunities %></td>
        </tr>

        <tr>
          <td>Replacements Sold</td>
          <td><%= @entry.repair_sold %></td>
          <td><%= @budget.repair_sold/@budget_days %></td>
          <td><%= @entries.sum(:repair_sold) %></td>
          <td><%= (@budget.repair_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.repair_sold %></td>
        </tr>

        <tr>
          <td>Conversion Ratio</td>
          <td>
            <% if @entry.repair_opportunities == 0 or @entry.repair_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.repair_sold.to_f/@entry.repair_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.repair_opportunities/@budget_days) == 0 or (@budget.repair_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.repair_sold/@budget_days).to_f/(@budget.repair_opportunities/@budget_days).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:repair_opportunities) == 0 or @entries.sum(:repair_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:repair_sold).to_f/@entries.sum(:repair_opportunities).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.repair_opportunities == 0 or @budget.repair_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.repair_sold.to_f/@budget.repair_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Dollars Sold</td>
          <td><%= number_to_currency @entry.repair_dollars_sold %></td>
          <td><%= number_to_currency(@budget.repair_dollars_sold/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:repair_dollars_sold) %></td>
          <td><%= number_to_currency((@budget.repair_dollars_sold/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.repair_dollars_sold %></td>
        </tr>

        <tr>
          <td>Average Replacement Ticket</td>
          <td>
            <% if @entry.repair_sold == 0 or @entry.repair_dollars_sold == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.repair_dollars_sold/@entry.repair_sold.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.repair_sold/@budget_days) == 0 or (@budget.repair_dollars_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.repair_dollars_sold/@budget_days).to_f/(@budget.repair_sold/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:repair_sold) == 0 or @entries.sum(:repair_dollars_sold) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:repair_dollars_sold).to_f/@entries.sum(:repair_sold)) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.repair_sold == 0 or @budget.repair_dollars_sold == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.repair_dollars_sold/@budget.repair_sold.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>
      </tbody>

      <thead>
        <tr>
          <th><strong>Maintenance</strong></th>
          <%=raw th %>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Calls Run</td>
          <td><%= @entry.maintenance_calls %></td>
          <td><%= @budget.maintenance_calls/@budget_days %></td>
          <td><%= @entries.sum(:maintenance_calls) %></td>
          <td><%= (@budget.maintenance_calls/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.maintenance_calls %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= number_to_currency @entry.maintenance_revenue %></td>
          <td><%= number_to_currency(@budget.maintenance_revenue/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:maintenance_revenue) %></td>
          <td><%= number_to_currency((@budget.maintenance_revenue/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.maintenance_revenue %></td>
        </tr>

        <tr>
          <td>COG's</td>
          <td><%= number_to_currency @entry.maintenance_cogs %></td>
          <td><%= number_to_currency(@budget.maintenance_cogs/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:maintenance_cogs) %></td>
          <td><%= number_to_currency((@budget.maintenance_cogs/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.maintenance_cogs %></td>
        </tr>

        <tr>
          <td>Average Ticket</td>
          <td>
            <% if @entry.maintenance_revenue == 0 or @entry.maintenance_calls == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.maintenance_revenue/@entry.maintenance_calls.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.maintenance_revenue/@budget_days) == 0 or (@budget.maintenance_calls/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.maintenance_revenue/@budget_days).to_f/(@budget.maintenance_calls/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:maintenance_revenue) == 0 or @entries.sum(:maintenance_calls) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:maintenance_revenue).to_f/@entries.sum(:maintenance_calls).to_f) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.maintenance_revenue == 0 or @budget.maintenance_calls == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.maintenance_revenue/@budget.maintenance_calls.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Membership Opportunities Run</td>
          <td><%= @entry.maintenance_membership_opportunities %></td>
          <td><%= @budget.maintenance_membership_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:maintenance_membership_opportunities) %></td>
          <td><%= (@budget.maintenance_membership_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.maintenance_membership_opportunities %></td>
        </tr>

        <tr>
          <td>Memberships Sold</td>
          <td><%= @entry.maintenance_memberships_sold %></td>
          <td><%= @budget.maintenance_memberships_sold/@budget_days %></td>
          <td><%= @entries.sum(:maintenance_memberships_sold) %></td>
          <td><%= (@budget.maintenance_memberships_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.maintenance_memberships_sold %></td>
        </tr>

        <tr>
          <td>Membership Conversion Rate</td>
          <td>
            <% if @entry.maintenance_membership_opportunities == 0 or @entry.maintenance_memberships_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.maintenance_memberships_sold.to_f/@entry.maintenance_membership_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.maintenance_membership_opportunities/@budget_days) == 0 or (@budget.maintenance_memberships_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.maintenance_memberships_sold/@budget_days).to_f/(@budget.maintenance_membership_opportunities/@budget_days).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:maintenance_membership_opportunities) == 0 or @entries.sum(:maintenance_memberships_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:maintenance_memberships_sold).to_f/@entries.sum(:maintenance_membership_opportunities).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.maintenance_membership_opportunities == 0 or @budget.maintenance_memberships_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.maintenance_memberships_sold.to_f/@budget.maintenance_membership_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Opportunities Run</td>
          <td><%= @entry.maintenance_opportunities %></td>
          <td><%= @budget.maintenance_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:maintenance_opportunities) %></td>
          <td><%= (@budget.maintenance_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.maintenance_opportunities %></td>
        </tr>

        <tr>
          <td>Replacements Sold</td>
          <td><%= @entry.maintenance_sold %></td>
          <td><%= @budget.maintenance_sold/@budget_days %></td>
          <td><%= @entries.sum(:maintenance_sold) %></td>
          <td><%= (@budget.maintenance_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.maintenance_sold %></td>
        </tr>

        <tr>
          <td>Conversion Ratio</td>
          <td>
            <% if @entry.maintenance_opportunities == 0 or @entry.maintenance_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.maintenance_sold.to_f/@entry.maintenance_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.maintenance_opportunities/@budget_days) == 0 or (@budget.maintenance_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.maintenance_sold/@budget_days).to_f/(@budget.maintenance_opportunities/@budget_days).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:maintenance_opportunities) == 0 or @entries.sum(:maintenance_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:maintenance_sold).to_f/@entries.sum(:maintenance_opportunities))*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.maintenance_opportunities == 0 or @budget.maintenance_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.maintenance_sold.to_f/@budget.maintenance_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Dollars Sold</td>
          <td><%= number_to_currency @entry.maintenance_dollars_sold %></td>
          <td><%= number_to_currency(@budget.maintenance_dollars_sold/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:maintenance_dollars_sold) %></td>
          <td><%= number_to_currency((@budget.maintenance_dollars_sold/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.maintenance_dollars_sold %></td>
        </tr>

        <tr>
          <td>Average Replacement Ticket</td>
          <td>
            <% if @entry.maintenance_sold == 0 or @entry.maintenance_dollars_sold == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.maintenance_dollars_sold/@entry.maintenance_sold.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.maintenance_sold/@budget_days) == 0 or (@budget.maintenance_dollars_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.maintenance_dollars_sold/@budget_days).to_f/(@budget.maintenance_sold/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:maintenance_sold) == 0 or @entries.sum(:maintenance_dollars_sold) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:maintenance_dollars_sold).to_f/@entries.sum(:maintenance_sold)) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.maintenance_sold == 0 or @budget.maintenance_dollars_sold == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.maintenance_dollars_sold/@budget.maintenance_sold.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>
      </tbody>

      <thead>
        <tr>
          <th><strong>Specialty</strong></th>
          <%=raw th %>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Calls Run</td>
          <td><%= @entry.specialty_calls %></td>
          <td><%= @budget.specialty_calls/@budget_days %></td>
          <td><%= @entries.sum(:specialty_calls) %></td>
          <td><%= (@budget.specialty_calls/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.specialty_calls %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= number_to_currency @entry.specialty_revenue %></td>
          <td><%= number_to_currency(@budget.specialty_revenue/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:specialty_revenue) %></td>
          <td><%= number_to_currency((@budget.specialty_revenue/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.specialty_revenue %></td>
        </tr>

        <tr>
          <td>COG's</td>
          <td><%= number_to_currency @entry.specialty_cogs %></td>
          <td><%= number_to_currency(@budget.specialty_cogs/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:specialty_cogs) %></td>
          <td><%= number_to_currency((@budget.specialty_cogs/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.specialty_cogs %></td>
        </tr>

        <tr>
          <td>Average Ticket</td>
          <td>
            <% if @entry.specialty_revenue == 0 or @entry.specialty_calls == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.specialty_revenue/@entry.specialty_calls.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.specialty_revenue/@budget_days) == 0 or (@budget.specialty_calls/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.specialty_revenue/@budget_days).to_f/(@budget.specialty_calls/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:specialty_revenue) == 0 or @entries.sum(:specialty_calls) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:specialty_revenue).to_f/@entries.sum(:specialty_calls).to_f) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.specialty_revenue == 0 or @budget.specialty_calls == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.specialty_revenue/@budget.specialty_calls.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Membership Opportunities Run</td>
          <td><%= @entry.specialty_membership_opportunities %></td>
          <td><%= @budget.specialty_membership_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:specialty_membership_opportunities) %></td>
          <td><%= (@budget.specialty_membership_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.specialty_membership_opportunities %></td>
        </tr>

        <tr>
          <td>Memberships Sold</td>
          <td><%= @entry.specialty_memberships_sold %></td>
          <td><%= @budget.specialty_memberships_sold/@budget_days %></td>
          <td><%= @entries.sum(:specialty_memberships_sold) %></td>
          <td><%= (@budget.specialty_memberships_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.specialty_memberships_sold %></td>
        </tr>

        <tr>
          <td>Membership Conversion Rate</td>
          <td>
            <% if @entry.specialty_membership_opportunities == 0 or @entry.specialty_memberships_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.specialty_memberships_sold.to_f/@entry.specialty_membership_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.specialty_membership_opportunities/@budget_days) == 0 or (@budget.specialty_memberships_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.specialty_memberships_sold/@budget_days).to_f/(@budget.specialty_membership_opportunities).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:specialty_membership_opportunities) == 0 or @entries.sum(:specialty_memberships_sold) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:specialty_memberships_sold).to_f/@entries.sum(:specialty_membership_opportunities).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.specialty_membership_opportunities == 0 or @budget.specialty_memberships_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.specialty_memberships_sold.to_f/@budget.specialty_membership_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Opportunities Run</td>
          <td><%= @entry.specialty_opportunities %></td>
          <td><%= @budget.specialty_opportunities/@budget_days %></td>
          <td><%= @entries.sum(:specialty_opportunities) %></td>
          <td><%= (@budget.specialty_opportunities/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.specialty_opportunities %></td>
        </tr>

        <tr>
          <td>Replacements Sold</td>
          <td><%= @entry.specialty_sold %></td>
          <td><%= @budget.specialty_sold/@budget_days %></td>
          <td><%= @entries.sum(:specialty_sold) %></td>
          <td><%= (@budget.specialty_sold/@budget_days)*@entry.day_of_month %></td>
          <td><%= @budget.specialty_sold %></td>
        </tr>

        <tr>
          <td>Conversion Ratio</td>
          <td>
            <% if @entry.specialty_opportunities == 0 or @entry.specialty_sold == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entry.specialty_sold.to_f/@entry.specialty_opportunities.to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if (@budget.specialty_sold/@budget_days) == 0 or (@budget.specialty_opportunities/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= "#{(((@budget.specialty_sold/@budget_days).to_f/(@budget.specialty_opportunities/@budget_days).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:specialty_sold) == 0 or @entries.sum(:specialty_opportunities) == 0 %>
              &ndash;
            <% else %>
              <%= "#{((@entries.sum(:specialty_sold).to_f/@entries.sum(:specialty_opportunities).to_f)*100).round(2)}%" %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.specialty_opportunities == 0 or @budget.specialty_sold == 0 %>
                &ndash;
              <% else %>
                <%= "#{((@budget.specialty_sold.to_f/@budget.specialty_opportunities.to_f)*100).round(2)}%" %>
              <% end %>
            </td>
          <% end %>
        </tr>

        <tr>
          <td>Replacement Dollars Sold</td>
          <td><%= number_to_currency @entry.specialty_dollars_sold %></td>
          <td><%= number_to_currency(@budget.specialty_dollars_sold/@budget_days) %></td>
          <td><%= number_to_currency @entries.sum(:specialty_dollars_sold) %></td>
          <td><%= number_to_currency((@budget.specialty_dollars_sold/@budget_days)*@entry.day_of_month) %></td>
          <td><%= number_to_currency @budget.specialty_dollars_sold %></td>
        </tr>

        <tr>
          <td>Average Replacement Ticket</td>
          <td>
            <% if @entry.specialty_sold == 0 or @entry.specialty_dollars_sold == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entry.specialty_dollars_sold/@entry.specialty_sold.to_f) %>
            <% end %>
          </td>
          <td>
            <% if (@budget.specialty_dollars_sold/@budget_days) == 0 or (@budget.specialty_sold/@budget_days) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency((@budget.specialty_dollars_sold/@budget_days).to_f/(@budget.specialty_sold/@budget_days).to_f) %>
            <% end %>
          </td>
          <td>
            <% if @entries.sum(:specialty_dollars_sold) == 0 or @entries.sum(:specialty_sold) == 0 %>
              &ndash;
            <% else %>
              <%= number_to_currency(@entries.sum(:specialty_dollars_sold)/@entries.sum(:specialty_sold)) %>
            <% end %>
          </td>
          <% 2.times do %>
            <td>
              <% if @budget.specialty_sold == 0 or @budget.specialty_dollars_sold == 0 %>
                &ndash;
              <% else %>
                <%= number_to_currency(@budget.specialty_dollars_sold/@budget.specialty_sold.to_f) %>
              <% end %>
            </td>
          <% end %>
        </tr>
      </tbody>
    <% end %>
  </table>

  <% if !@entry.blank? %>
    <hr>

    <div class="half">
      <h1>Memberships</h1>
      <table class="journeyboard">
        <thead>
          <tr>
            <th></th>
            <th>Yesterday</th>
            <th>MTD</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>Memberships Sold by CSR's</td>
            <td><%= @entry.memberships_sold_by_csr %></td>
            <td><%= @entries.sum(:memberships_sold_by_csr) %></td>
          </tr>

          <tr>
            <td>Memberships Sold With New Systems</td>
            <td><%= @entry.memberships_sold_new_systems %></td>
            <td><%= @entries.sum(:memberships_sold_new_systems) %></td>
          </tr>

          <tr>
            <td>Total Memberships Added</td>
            <td><%= @entry.memberships_sold_by_csr + @entry.memberships_sold_new_systems %></td>
            <td><%= @entries.sum(:memberships_sold_by_csr) + @entries.sum(:memberships_sold_new_systems) %></td>
          </tr>

          <tr>
            <td>Memberships Lost</td>
            <td><%= @entry.memberships_lost %></td>
            <td><%= @entries.sum(:memberships_lost) %></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="half">
      <h1>Comfort Advisor Sales Performance</h1>
      <table class="journeyboard">
        <thead>
          <tr>
            <th>Comfort Advisor</th>
            <th>Sold</th>
            <th>Calls Run</th>
            <th>Calls Sold</th>
          </tr>
        </thead>

        <tbody>
          <% @entry.comfort_advisor_entries.each do |comfort_advisor_entry| %>
            <tr>
              <td><%= comfort_advisor_entry.comfort_advisor.name %></td>
              <td><%= number_to_currency comfort_advisor_entry.sold %></td>
              <td><%= comfort_advisor_entry.calls_run %></td>
              <td><%= comfort_advisor_entry.calls_sold %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
<% end %>

<%= render :partial => '/refinery/content_page', :locals => { :full_width => true } %>