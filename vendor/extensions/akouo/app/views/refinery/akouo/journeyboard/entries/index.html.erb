<% content_for :body do %>
  <%= link_to 'New Entry', refinery.new_akouo_journeyboard_entry_path %> |
  <%= link_to 'New CSR Entry', refinery.new_akouo_journeyboard_csr_entry_path %> |
  <%= link_to 'Employees', refinery.akouo_journeyboard_employees_path %>

  <hr>

  <%= render 'date_select' %>

  <hr>

  <% @profit_centers.each do |profit_center| %>
    <h1><%= profit_center.pcn %></h1>

    <% entries = profit_center.journeyboard_entries.where(:date => (@mtd) ? @date.beginning_of_month..@date : @date).order('date DESC') %>
    <table class="journeyboard">
      <% if entries.blank? %>
        <tr>
          <td>No Entries Yet</td>
        </tr>
      <% else %>
        <thead>
          <tr>
            <th>Date</th>
            <th>Employee</th>
            <th>Revenue</th>
            <th>Cost</th>
            <th>Leads sold</th>
            <th title="Lead opportunities">Lead opp.</th>
            <th>Calls Run</th>
            <th>Hours</th>
            <th title="Margin per hour">MPH</th>
            <th>Agreements</th>
            <th></th>
          </tr>
        </thead>
        <% entries.each do |entry| %>
          <tbody>
            <tr>
              <td><%= entry.date.strftime('%b %e, %Y') %></td>
              <td><%= link_to entry.employee.name, refinery.akouo_journeyboard_employee_path(entry.employee) %></td>
              <td><%= number_to_currency(entry.revenue+entry.accessories) %></td>
              <td><%= number_to_currency(entry.commission+entry.todays_pay+entry.fuel_cost+entry.parts+entry.additional_labor) %></td>
              <td><%= entry.leads %></td>
              <td><%= entry.opportunities %></td>
              <td><%= entry.calls_run %></td>
              <td><%= entry.hours %></td>
              <td><%= "#{number_to_currency(((entry.revenue+entry.accessories)-(entry.commission+entry.todays_pay+entry.fuel_cost+entry.parts+entry.additional_labor))/entry.hours)}/hr" %></td>
              <td class="agreements">
                <table>
                  <tr>
                    <%= content_tag :td, entry.agreement_1, :class => 'platinum' %>
                    <%= content_tag :td, entry.agreement_2, :class => 'gold' %>
                    <%= content_tag :td, entry.agreement_3, :class => 'silver' %>
                    <%= content_tag :td, entry.agreement_4, :class => 'bronze' %>
                  </tr>
                </table>
              </td>
              <td><%= link_to 'Edit', refinery.edit_akouo_journeyboard_entry_path(entry) %></td>
            </tr>
          </tbody>
        <% end %>
      <% end %>
    </table>

    <hr>
  <% end %>

  <h1>Memberships</h1>
  <table class="journeyboard">
    <% entries = @user.journeyboard_csr_entries.where(:date => (@mtd) ? @date.beginning_of_month..@date : @date).order('date DESC') %>
    <% if entries.blank? %>
      <tr>
        <td>No Entries Yet</td>
      </tr>
    <% else %>
      <thead>
        <tr>
          <th>Date</th>
          <th>Memberships Sold</th>
          <th>Sold With New Systems</th>
          <th>Memberships Lost</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <% entries.each do |entry| %>
          <tr>
            <td><%= entry.date.strftime('%b %e, %Y') %></td>
            <td><%= entry.sold %></td>
            <td><%= entry.sold_new_systems %></td>
            <td><%= entry.lost %></td>
            <td><%= link_to 'Edit', refinery.edit_akouo_journeyboard_csr_entry_path(entry) %></td>
          </tr>
        <% end %>
      </tbody>
    <% end %>
  </table>
<% end %>

<%= render :partial => '/refinery/content_page', :locals => { :full_width => true } %>