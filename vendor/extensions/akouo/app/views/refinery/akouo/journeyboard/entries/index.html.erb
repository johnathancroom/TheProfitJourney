<% content_for :body do %>
  <%= link_to "New Entry", refinery.new_akouo_journeyboard_entry_path %> |
  <%= link_to "Tech List", refinery.akouo_journeyboard_technicians_path %>

  <hr>

  <form method="GET" class="js_date_select">
    <%= hidden_field_tag :date %>

    Viewing <%= select_date @date, :order => [:month, :day, :year] %>
    <%= submit_tag "Submit", :class => "button", :style => "top: 0;" %>
  </form>

  <hr>

  <% @profit_centers.each do |profit_center| %>
    <h1><%= profit_center.pcn %></h1>

    <% entries = profit_center.journeyboard_entries.where(:date => @date) %>
    <table class="journeyboard">
      <% if entries.blank? %>
        <tr>
          <td>No Entries Yet</td>
        </tr>
      <% else %>
        <thead>
          <tr>
            <th>Tech</th>
            <th>Revenue</th>
            <th>Cost</th>
            <th>Add-on</th>
            <th>Leads sold</th>
            <th>Lead opp.</th>
            <th>Tickets</th>
            <th>Hours</th>
            <th>MPH</th>
            <th>Agreements</th>
            <th></th>
          </tr>
        </thead>
        <% entries.each do |entry| %>
          <tbody>
            <tr>
              <td><%= link_to entry.technician.name, refinery.akouo_journeyboard_technician_path(entry.technician) %></td>
              <td><%= number_to_currency entry.revenue %></td>
              <td><%= number_to_currency(entry.commission+entry.todays_pay+entry.fuel_cost+entry.parts+entry.additional_labor) %></td>
              <td><%= entry.add_on %></td>
              <td><%= entry.leads %></td>
              <td><%= entry.opportunities %></td>
              <td><%= entry.tickets %></td>
              <td><%= entry.hours %></td>
              <td><%= "#{number_to_currency((entry.revenue-(entry.commission+entry.todays_pay+entry.fuel_cost+entry.parts+entry.additional_labor))/entry.hours)}/hr" %></td>
              <td class="agreements">
                <table>
                  <tr>
                    <%= content_tag :td, entry.agreement_1, :class => "platinum" %>
                    <%= content_tag :td, entry.agreement_2, :class => "gold" %>
                    <%= content_tag :td, entry.agreement_3, :class => "silver" %>
                    <%= content_tag :td, entry.agreement_4, :class => "bronze" %>
                  </tr>
                </table>
              </td>
              <td><%= link_to "Edit", refinery.edit_akouo_journeyboard_entry_path(entry) %></td>
            </tr>
          </tbody>
        <% end %>
      <% end %>
    </table>

    <%= tag :hr if profit_center != @profit_centers.last %>
  <% end %>
<% end %>

<% content_for :javascripts do %>
  <script type="text/javascript">
    $(".js_date_select").submit(function(e) {
      e.preventDefault();

      // Set date hidden value
      $("#date").val($("#date_month", this).val()+"-"+$("#date_day", this).val()+"-"+$("#date_year").val())

      // Remove original date select
      $("#date_month, #date_day, #date_year, .button", this).attr("name", "");

      this.submit();
    })
  </script>
<% end %>

<%= render :partial => '/refinery/content_page', :locals => { :full_width => true } %>